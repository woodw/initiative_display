<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Dungeon Master Screen</title>
		<script src="/socket.io/socket.io.js"></script>
		<title>initiative display</title>
		<style>
			body{
				margin:0;
				padding:0;
			}
			.container{
				width:80vw;
				margin:0 auto;
				min-height:100vh;
				background-color:blue;

				display:flex;
				flex-direction: column;
				align-items: center;
			}
			.search_container,.login_container{
				margin:3%;
				display:flex;
				flex-direction: column;
				align-items: center;
			}

			input#group-name{
				text-transform: lowercase;
			}	

			.hide{
				display:none;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>D&D Initiative Display</h1>
			<p>Welcome to the D&D Initiative Display application. This tool will aid you and your gaming group in visualizing the action that happens at your table.</p>
			<div class="search_container">
				<label for="groupname">Please enter your registered group name in the field below. We utilize slack to validate who you are and your role within the group.</label>
				<input name="groupname" id="group-name" type="text" placeholder="group name"/>
				<button id="group-search">Search</button>
			</div>
			<div class="login_container hide">
				<a class="slack_login-link" href="https://slack.com/oauth/authorize?scope=identity.basic,identity.email,identity.team,identity.avatar&client_id=191860339156.308207846070"><img alt="Sign in with Slack" height="40" width="172" src="https://platform.slack-edge.com/img/sign_in_with_slack.png" srcset="https://platform.slack-edge.com/img/sign_in_with_slack.png 1x, https://platform.slack-edge.com/img/sign_in_with_slack@2x.png 2x" /></a>
				- or -
				<a class="app_stage-link" href="/stage">Watch the Action</a>
			</div>
		</div>

		<script>
		let app = {};

		document.addEventListener('DOMContentLoaded', function() {
			console.log(window.location.pathname.replace('/',''));
		/****************************Scope Objects*****************************/	
			let socket, backdrops, sketches, audioTracks, elements, actors, uniqueID, initiativePointer;

			app.init = init;

			app.init();

			/****************************INIT Function*****************************/		
			function init(){
				elements = registerElements();

				registerListeners();
				initSocket();
			}

			function addEventListenerList(list, event, fn) {
				for (var i = 0, len = list.length; i < len; i++) {
					list[i].addEventListener(event, fn, false);
				}
			}

			function byCSS(cssSelector){
				return document.querySelector(cssSelector);
			}
			
			function byCSSAll(cssSelector){
				return document.querySelectorAll(cssSelector);
			}

			function registerElements(){
				return {
					groupName: byCSS('#group-name'),
					slackButton: byCSS('.slack_login-link'),
					searchGroup: byCSS('.search_container'),
					searchButton: byCSS('#group-search'),
					loginGroup: byCSS('.login_container')
				};
			}

			function registerListeners(){
				elements.searchButton.addEventListener('click', lookForGame);	
			}
			function lookForGame(event, one, two){
				
				if(elements.groupName.value.length>=3){
					socket.emit('get_adventure_indx',{game:elements.groupName.value}, function(data){
						if(data.meta){
							elements.slackButton.setAttribute('href', 'https://slack.com/oauth/authorize?scope=identity.basic,identity.email,identity.team,identity.avatar&client_id=' + data.meta.client);
							elements.searchGroup.classList.toggle('hide');
							elements.loginGroup.classList.toggle('hide');
						}
					});
				}

				socket.emit('reset_dm');
			}


			function initSocket(){
				socket = io.connect((window.location.href + 'lol').replace((window.location.pathname+'lol'),''));
				
				socket.on('socket connection', socketConnection);
			}

			function socketConnection(data) {
				console.log(data);
			}
		});
		</script>
	</body>
</html>